function hjsCalendar(e) {
	
	console.log("funciona consola");
	
	var fechasHoras;
	function recogerJSON(){
		const url='../assets/JSON/visitas.json';
	
		return fetch(url)
		.then(response => {
		  if (!response.ok) {
			throw new Error('Error en la solicitud');
		  }
		  return response.json();
		})
		.then(data => {
		 //return data;
		 console.log("entra ahora");
		   fechasHoras=data;
		  console.log(data);
		})
		.catch(error => {
		  console.error('Error al obtener los datos:', error);
		});
	
	
	}

	function parsearFecha(json,año,mes,dia,hora){
		console.log(json);
		console.log("entra en la funicon de parseo");
		/*
		console.log(typeof json);
// Construir una fecha con los parámetros proporcionados
console.log("   ");
console.log("año"+año);
console.log("   ");
console.log("mes"+mes);
console.log("   ");
console.log("dia"+dia);
console.log("   ");
console.log("hora"+hora);
console.log("   ");
*/

const fechaComparar = new Date(año, mes , dia, hora);
console.log("la fevha que entra por parametro es"+fechaComparar);

// Recorrer el JSON y comparar las fechas y horas
for (const key in json) {
	if (json.hasOwnProperty(key)) {
		const elemento = json[key];

		var fechaSeparar1= elemento.dia;
        var fechaSeparar = fechaSeparar1.split('-');
        for(let i=0;i<3;i++){
            if (fechaSeparar[i].charAt(0) === '0') {
                //console.log("primer caracter es cero000000000000000000");
                        // Si es un cero, eliminar el primer carácter
                        fechaSeparar[i] = fechaSeparar[i].substring(1);  
                      }
        }
        for(let i=0;i<3;i++){
            fechaSeparar[i]=parseInt(fechaSeparar[i]);
        }
        var anoSeparado = fechaSeparar[0];
        var mesSeparado = fechaSeparar[1];
        var diaSeparado = fechaSeparar[2];

		const fechaJson = new Date(anoSeparado,mesSeparado-1,diaSeparado,elemento.hora);
        console.log("feha del json:"+fechaJson);
        let diaJsonpr = fechaJson.getDay
        console.log("dia del json"+diaJsonpr);
        console.log("mes del json"+fechaJson.getMonth);
        console.log("año del json"+fechaJson.getFullYear);
        console.log("hora del json"+fechaJson.getHours);

		/*
		console.log("Dia en el json"+elemento.dia);
		console.log(typeof elemento.dia+"este es el tipod edia");
		console.log("Hora en el json"+elemento.hora);
		let diaPrintar=new Date("2024-01-20"+"20");
		console.log("dia puesto  mano:" + diaPrintar);
		const fechaJson = new Date(elemento.dia + " " + elemento.hora);
		console.log("feha del json:"+fechaJson);
		*/
		// Comparar las fechas
		if (fechaComparar.getTime() === fechaJson.getTime()) {
			console.log("fecha"+fechaComparar+"asignada999999999999999999999999999999999999");
			// La fecha y hora coinciden
			return true;
		}
	}
}

// Si ninguna fecha coincide
console.log("no trobat");
return false;
	}
	console.log(fechasHoras);
	console.log(typeof fechasHoras);
	var idTrabajador=1;
	var descripcion = "hola la descripcion funciona";
	document.getElementById("hjsCalendar").innerHTML = `
    <div class="">
        <div class="justify-content-center d-md-flex">
        <div class="bg-white left">
            <div class="bg-white calendar mx-auto pb-3 px-2">
            <div class="d-flex align-items-center justify-content-between text-uppercase month py-4">
                <div class="fw-bold text-primary ms-3" id="date"></div>
                <div class="d-flex align-items-center justify-content-center gap-3">
                <div class="d-flex align-items-center justify-content-center rounded-circle" id="prev">
                    <i class="fa fa-angle-left"></i>
                </div>
                <div class="d-flex align-items-center justify-content-center rounded-circle" id="nxt">
                    <i class="fa fa-angle-right"></i>
                </div>
                </div>
            </div>
            <div class="d-flex align-items-center justify-content-between text-uppercase fw-light h-100 mb-2 text-sm w-100 weekdays">
                <div class="fw-bold">Dom</div>
                <div class="fw-bold">Lun</div>
                <div class="fw-bold">Mar</div>
                <div class="fw-bold">Mié</div>
                <div class="fw-bold">Jue</div>
                <div class="fw-bold">Vie</div>
                <div class="fw-bold">Sáb</div>
            </div>
            <div class="d-flex justify-content-between w-100 flex-wrap" id="days"></div>
            </div>
        </div>
        <div class="bg-white d-none px-3 right" id="rightContent">
            <div class="fw-bold text-primary d-flex py-5" id="today-date">
            <div id="event-day">Miércoles,</div>
            <div id="event-date">19 de abril</div>
            </div>
            <div class="text-center" style="width: 254px">
            <div class="events me-4" id="meeting_daily_timings"></div>
            </div>
        </div>
        </div>
    </div>
`;

document.getElementsByClassName("calendar");

	let t = document.getElementById("date"),
		n = document.getElementById("days"),
		i = document.getElementById("prev"),
		d = document.getElementById("nxt"),
		l = document.getElementById("rightContent");
	document.getElementById("activeEvent-time"), document.getElementById("activeConfirm-btn"), document.getElementsByClassName("event-time");
	let a = new Date,
		s = a.getMonth(),
		c = a.getFullYear(),
		r = a.getDate();
	a.setMonth(a.getMonth() + 1);
	let v = a.getMonth(),
        o = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];


	function m(e, t) {
		let n = [],
			i = new Date(e, t, 1);
		for (; i.getMonth() === t;) 0 === i.getDay() && n.push(i.getDate()), i.setDate(i.getDate() + 1);
		return n
	}
	var g = {};

	function u() {
		recogerJSON();
		console.log(fechasHoras+"fechasHoras");
		Date.now();
		let e = new Date(c, s, 1),
			i = new Date(c, s + 1, 0),
			d = new Date(c, s, 0),
			a = d.getDate(),
			u = i.getDate(),
			f = e.getDay(),
			b = 7 - i.getDay() - 1;
		t.innerHTML = o[s] + " " + c;
		let h = "";
		for (let p = f; p > 0; p--) h += `<div class='day prev-date'>${a - p + 1}</div>`;
		for (let $ = 1; $ <= u; $++) $ < new Date().getDate() && c === new Date().getFullYear() && s === new Date().getMonth() || m(c, s).includes($) ? h += `<div class='day tillCurrentDate'> ${$} </div>` : $ === new Date().getDate() && c === new Date().getFullYear() && s === new Date().getMonth() ? h += `<div class='day today'>${$} </div>` : s === new Date().getMonth() && c === new Date().getFullYear() || s === v && c === new Date().getFullYear() ? h += `<div class="day">${$}</div>` : h += `<div class="day futureDays">${$}</div>`;
		for (let x = 1; x <= b; x++) h += `<div class='day nxt-date'>${x}</div>`;
		
		n.innerHTML = h,
			function e() {
				let t = document.querySelectorAll(".day"),
					n = m(c, s);
				t.forEach(e => {
					e.addEventListener("click", i => {
						if (-1 !== n.indexOf(Number(e.textContent))) console.log("this is sunday");
						else if (t.forEach(e => {
								e.classList.remove("active")
							}), e.textContent >= r && s === new Date().getMonth() || s === v && !n.includes(Number(e.textContent))) {
							l.classList.remove("d-none"),
								function e(t) {
									let n = new Date(c, s, t),
										i = n.toLocaleString("es-ES", {
											weekday: "long"
										});
									y.innerHTML = i, w.innerHTML = ", " + o[s] + " " + t
								}(i.target.innerHTML), e.classList.add("active");
							let d = e.innerHTML,
								a = document.getElementById("meeting_daily_timings"),
								m = "",
								u = "",
								f = "";
							for (let b = 8; b < 21; b++) {
								let coincide=false;
								new Date(c, s, d, b, 0, 0, 0).getTime() < Date.now() ? (u = "disabled", f = "btnDisable") : (u = "", f = "");
								coincide =parsearFecha(fechasHoras,c,s,d,b);
								if(coincide===true){
									u = "disabled";
									f = "btnDisable";
								}
								var h = new Date(c, s, d, b, 0, 0, 0).toLocaleString("en-GB", {
									hour12: !0,
									hour: "numeric",
									minute: "numeric"
								});
								g[new Date(c, s, d, b).toJSON()] > 2 ? m += `<div class="button-full" id="prepTime_${b}">
                  <button class="event-time meeting btnDisable" disabled > ${12 === b ? "12:00 pm" : h}
              </button></div>` : m += `<div class="button-full" id="prepTime_${b}">
                  <button onclick="meetTime('prepTime_${b}')" class="event-time meeting ${f}" ${u} > ${12 === b ? "12:00 pm" : h}
              </button>
                  <button onclick="confirmMeeting('${new Date(c, s, d, b, 0, 0, 0).toJSON()}','1')" class="confirm-btn">Confirmar</button>
              </div>`
							}
							return a.innerHTML = m, m
						}
					})
				})
			}()
	}
	u(), i.addEventListener("click", () => {
		--s < 0 && (s = 11, c--), u()
	}), d.addEventListener("click", () => {
		++s > 11 && (s = 0, c++), u()
	});
	let f = null;
	this.meetTime = e => {
		var t = document.getElementById(e);
		null !== f && (f.children[0].classList.remove("activeEvent-time"), f.children[1].classList.remove("activeConfirm-btn")), t.children[0].classList.add("activeEvent-time"), t.children[1].classList.add("activeConfirm-btn"), f = t
	};
	let y = document.getElementById("event-day"),
		w = document.getElementById("event-date");
	//this.confirmMeeting = (t,idTrabajador,descripcion) => e(t,idTrabajador,descripcion)
	this.confirmMeeting = (t, idTrabajador, descripcion) => {
		// Realizar solicitud AJAX para enviar parámetros a PHP
		const apiUrl = '../php/insertCitas.php'; 
		var fechaAlm = new Date(t);
    const año = fechaAlm.getFullYear();
    const mes = fechaAlm.getMonth() + 1;
    const dia = fechaAlm.getDate();
    ; // Puedes proporcionar el valor correcto aquí si es necesario

    // Concatenar en un solo string
    const fechaString = `${año}-${mes < 10 ? '0' : ''}${mes}-${dia < 10 ? '0' : ''}${dia}`;
    console.log("fecha introducida para insertar " + fechaString);

    var horaIn = fechaAlm.getHours();
	console.log(""+horaIn);
    var minutos = fechaAlm.getMinutes();  // Obtener minutos
    var segundos = fechaAlm.getSeconds();  // Obtener segundos

    // Formatear las horas, minutos y segundos al formato de MySQL
    var horaString = `${horaIn < 10 ? '0' : ''}${horaIn}:${minutos < 10 ? '0' : ''}${minutos}:${segundos < 10 ? '0' : ''}${segundos}`;

    console.log("día a insertar: " + fechaString);
    console.log("hora a insertar: " + horaString);
		// Crear objeto FormData y agregar parámetros
		const datosCita = new FormData();
		//datosCita.append('hora', t);
		datosCita.append('fecha',fechaString);
		datosCita.append('hora',horaString);
		datosCita.append('idTrabajador', idTrabajador);
		datosCita.append('descripcion', descripcion);
		console.log(descripcion);
		console.log(idTrabajador);
		// Realizar la solicitud fetch
		fetch(apiUrl, {
			method: 'POST',
			body: datosCita,
		})
		.then(response => {
			if (!response.ok) {
				throw new Error('Error en la solicitud');
			}
			return response.json();
		})
		.then(data => {
			console.log(data);
			if (data.success) {
				// Mostrar "Realizada con éxito" en el modal-footer
				let modalFooter = document.querySelector(".modal-footer");
				modalFooter.innerHTML = "<p>Realizada con éxito</p>";
			} else {
				// Mostrar un mensaje en el modal-footer si no se cumple la condición
				let modalFooter = document.querySelector(".modal-footer");
				modalFooter.innerHTML = `<p>No se pudo realizar la acción: ${data.message}</p>`;
			}
		})
		.catch(error => {
			console.error('Error:', error);
		});
	};
	
}
